<!DOCTYPE html>
<html lang="zh-Hant">
<head>
    <link rel="icon" type="image/png" href="./JP.png">
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>2025å¤§é˜ªæ¥“å¹´ç¥­æ•£ç­–æ—…åœ–</title>
    <!-- è¼‰å…¥ Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- è¼‰å…¥ Noto Serif TC (æ˜é«”) å­—é«” -->
    <link href="https://fonts.googleapis.com/css2?family=Noto+Serif+TC:wght@400;700&display=swap" rel="stylesheet">
    <style>
        /* è¨­å®šä¸»è¦å­—é«”ç‚ºæ˜é«”ï¼Œä¸¦åŠ å…¥å„ªé›…çš„è¥¯ç·šå­—é«”ä½œç‚ºå‚™ç”¨ */
        body {
            font-family: 'Noto Serif TC', 'Georgia', 'Times New Roman', Times, serif;
            color: #333;
            overflow-x: hidden; /* é˜²æ­¢æ»¾å‹•æ¢ */
            /* æ¥“è‘‰è‰²æ¼¸å±¤èƒŒæ™¯å‹•ç•« */
            background: linear-gradient(45deg, #fcf8f3, #fff5eb, #fff0e6, #fcece6);
            background-size: 400% 400%;
            animation: gradientBG 15s ease infinite;
        }

        /* ã€å‡ç´š 3ã€‘ç¾åŒ–æ»¾å‹•æ¢ï¼Œä½¿ç”¨ç§‹å­£é…è‰² */
        body::-webkit-scrollbar {
            width: 8px;
        }
        body::-webkit-scrollbar-track {
            background: #f9f0e1; /* æ·ºç±³è‰²èƒŒæ™¯ */
        }
        body::-webkit-scrollbar-thumb {
            background-color: #e53e3e; /* æ¥“è‘‰ç´… */
            border-radius: 4px;
            border: 2px solid #f9f0e1;
        }

        @keyframes gradientBG {
            0% { background-position: 0% 50%; }
            50% { background-position: 100% 50%; }
            100% { background-position: 0% 50%; }
        }

        /* æ¥“è‘‰é£„è½ç‰¹æ•ˆçš„ CSS (ä¿æŒä¸è®Š) */
        .maple-fall-container {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
            overflow: hidden;
            z-index: 10;
        }

        .maple-leaf {
            position: absolute;
            width: 20px;
            height: 20px;
            background-color: #e53e3e; /* æ¥“è‘‰ç´… */
            clip-path: polygon(50% 0%, 100% 30%, 80% 100%, 20% 100%, 0% 30%);
            opacity: 0;
        }

        /* ã€ä¿®æ­£ 1ã€‘å¤§æ¨™é¡Œå‹•æ…‹æ•ˆæœï¼šç¢ºä¿æ–‡å­—é¡è‰²é¡¯ç¤ºï¼Œä¸¦æ”¹ç”¨é‡‘è‰²å…‰æšˆå‹•ç•« */
        .animated-title {
            text-shadow: 2px 2px 4px rgba(0,0,0,0.2); 
            color: #b91c1c; /* ç¢ºä¿æ–‡å­—é¡¯ç¤ºç‚ºå¯¦å¿ƒæ¥“è‘‰ç´… */
            background: none; /* ç§»é™¤èƒŒæ™¯æ¼¸è®Š */
            -webkit-background-clip: unset; /* ç§»é™¤å‰ªè£ */
            -webkit-text-fill-color: unset; /* ç§»é™¤é€æ˜æ–‡å­—å¡«å…… */
            background-size: 100% 100%;
            animation: textGlow 4s linear infinite alternate; /* æ›¿æ›ç‚ºé‡‘è‰²å…‰æšˆé–ƒçˆ */
        }
        
        /* ã€æ–°å¢ã€‘é‡‘è‰²å…‰æšˆé–ƒçˆå‹•ç•« Keyframe */
        @keyframes textGlow {
            0% { text-shadow: 2px 2px 4px rgba(0,0,0,0.2); }
            50% { text-shadow: 0 0 10px #f6ad55, 0 0 20px #fef3c7; } /* åŠ å…¥é‡‘è‰²å…‰æšˆ */
            100% { text-shadow: 2px 2px 4px rgba(0,0,0,0.2); }
        }

        /* é ‚éƒ¨ Header æ»¾å‹•æ·¡å‡ºå‹•ç•« (ä¿æŒä¸è®Š) */
        @keyframes headerFadeOut {
            to { opacity: 0; transform: translateY(-30px); pointer-events: none; }
        }
        @keyframes headerFadeIn {
            from { opacity: 0; transform: translateY(-30px); }
            to { opacity: 1; transform: translateY(0); pointer-events: auto; }
        }

        /* æ¨™é¡Œæ–‡å­—å€‹é«”æ¼‚æµ®å‹•ç•« */
        @keyframes charFloat {
            0%, 10% { transform: translateY(0) scale(1); opacity: 1; }
            50% { transform: translateY(-12px) scale(1.05); opacity: 0.9; }
            100% { transform: translateY(0) scale(1); opacity: 1; }
        }
        
        /* å‰¯æ¨™é¡Œå­—ç¬¦æ»‘å‹•å‹•ç•« */
        @keyframes charSlideUp {
            0% { transform: translateY(20px) scale(0.9); opacity: 0; }
            50% { transform: translateY(-2px); opacity: 1; }
            100% { transform: translateY(0) scale(1); opacity: 1; }
        }
        
        .animated-subtitle { opacity: 1; }
        .flashing-border {
            border: 3px solid transparent;
            animation: flash 1.5s infinite alternate;
        }

        /* æ–°å¢ï¼šåˆ‡æ›åˆ°æ—¥æœŸé é¢å¾Œçš„ç·Šæ¹Šå‹æ¨™é¡Œå‹•ç•« */
        .day-header-compact {
            opacity: 0;
            transform: translateY(-20px);
            animation: headerSlideIn 0.5s ease-out forwards;
        }

        @keyframes headerSlideIn {
            to { opacity: 1; transform: translateY(0); }
        }

        /* ç¢ºä¿åŸæœ¬çš„å…ƒç´ åœ¨æ—¥æ›†æ¨¡å¼ä¸‹è¢«éš±è— */
        .hidden-content {
            display: none !important;
        }
        
        /* è®“ main-header åœ¨æ—¥æ›†æ¨¡å¼ä¸‹èˆ‡å…§å®¹å€æœ‰å€éš” */
        #main-header {
            margin-bottom: 2rem;
        }

        /* ----------------------- é ‚éƒ¨å°èˆªæ¬„ (Side Menu) - æ¶²æ…‹ç»ç’ƒ ----------------------- */
        #sidebar {
            position: fixed; top: 0; left: 0; width: 100%; height: auto; padding: 0.3rem 1rem; /* <-- è±¬å¤§å“¥æ”¹å‹•ï¼šè®“é¸å–®è®Šæ‰ */
            /* [æ¶²æ…‹ç»ç’ƒæ•ˆæœ] - 0.3 é€æ˜åº¦ */
            background-color: rgba(255, 255, 255, 0.3); 
            backdrop-filter: blur(12px); -webkit-backdrop-filter: blur(12px);
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1), 0 0 0 1px rgba(255, 255, 255, 0.6); 
            
            display: flex; flex-direction: row; align-items: center;
            transition: all 0.2s ease; /* åŠ å¿«æ”¶ç¸®é€Ÿåº¦ */
            overflow-x: auto; overflow-y: hidden; z-index: 50;
            border-bottom: 1px solid rgba(229, 62, 62, 0.1); 
        }

        /* æ»¾å‹•æ™‚çš„ç·Šæ¹Šç‹€æ…‹ (è®“é ‚éƒ¨å°èˆªæ¬„ã€Œä¼¸ç¸®è‡ªå¦‚ã€) */
        #sidebar.compact {
            padding-top: 0.1rem; padding-bottom: 0.1rem;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.2), 0 0 0 1px rgba(255, 255, 255, 0.6);
            justify-content: flex-start;
        }
        
        /* æ©«å‘æ»¾å‹•æ¢æ¨£å¼ (ç¾åŒ–) */
        #sidebar::-webkit-scrollbar { height: 6px; }
        #sidebar::-webkit-scrollbar-thumb { background-color: #fca5a5; border-radius: 3px; }

        .sidebar-item {
            display: flex; align-items: center; padding: 0.5rem 1rem; cursor: pointer;
            transition: all 0.3s ease; white-space: nowrap;
            border-bottom: 4px solid transparent; 
            margin-right: 0.75rem; 
            margin-bottom: 0;
        }

        /* æ»¾å‹•ç·Šæ¹Šæ™‚ï¼Œé …ç›®å…§é‚Šè·ä¹Ÿè·Ÿè‘—èª¿æ•´ */
        #sidebar.compact .sidebar-item { padding: 0.3rem 0.5rem; }

        .sidebar-item:hover {
            background-color: #fff7ed; 
            border-bottom-color: #fdba74; 
        }

        .sidebar-item.active {
            background-color: #fff1f2; 
            border-bottom-color: #e53e3e; 
        }

        .sidebar-icon-container {
            min-width: 2rem; height: 2rem; display: flex; align-items: center; justify-content: center; 
            margin-right: 0.5rem; /* <-- è±¬å¤§å“¥æ”¹å‹•ï¼šç¸®å°åœ–ç¤ºå³å´ç©ºé–“ */
            border-radius: 50%; background-color: #f3f4f6;
            transition: background-color 0.3s, margin-right 0.3s;
        }

        /* 1. æ»¾å‹•æ™‚ï¼Œç§»é™¤ ICON æ—é‚Šçš„ç©ºé–“ */
        #sidebar.compact .sidebar-icon-container { margin-right: 0; }

        .sidebar-text {
            opacity: 1; transform: translateX(0); transition: all 0.3s ease; 
            display: flex; flex-direction: column; min-width: 5rem; 
        }

        /* 2. æ»¾å‹•æ™‚ï¼Œå¾¹åº•éš±è—æ–‡å­—ä¸¦ç§»é™¤ä½”ç”¨å¯¬åº¦ */
        #sidebar.compact .sidebar-text {
            opacity: 0; width: 0; min-width: 0; overflow: hidden;
            padding: 0; pointer-events: none;
        }

        /* ----------------------- è¡Œç¨‹å…§å®¹å€ - æ¶²æ…‹ç»ç’ƒ (è±ªè¯å·è»¸ç‰ˆ) ----------------------- */
        #itinerary-content {
            width: 100%; max-width: 56rem;
            
            /* [æ¶²æ…‹ç»ç’ƒæ•ˆæœ] - 0.15 é€æ˜åº¦ */
            background-color: rgba(255, 255, 255, 0.15); 
            backdrop-filter: blur(20px); -webkit-backdrop-filter: blur(20px);
            
            /* ã€å‡ç´š 1ã€‘é‡‘è‰²åº•ç´‹ç–ŠåŠ ï¼Œå¢åŠ å¤æ¨¸æ„Ÿå’Œäº®åº¦ */
            background-image: linear-gradient(rgba(255, 255, 255, 0.3) 1px, transparent 1px), 
                              linear-gradient(90deg, rgba(255, 255, 255, 0.2) 1px, transparent 1px);
            background-size: 20px 20px;
            
            border: 1px solid rgba(255, 255, 255, 0.6); /* æ·ºè‰²ç»ç’ƒé‚Šæ¡† */
            box-shadow: 0 20px 50px rgba(0, 0, 0, 0.3), 0 0 15px rgba(255, 215, 0, 0.4); /* æµ®å‹•é™°å½± + è¼•å¾®é‡‘é‚Š */
            
            padding: 2.5rem; border-radius: 1.5rem; margin-top: 2rem;
            opacity: 0; transform: translateY(20px);
            transition: opacity 0.8s cubic-bezier(0.175, 0.885, 0.32, 1.275), transform 0.8s cubic-bezier(0.175, 0.885, 0.32, 1.275);
            display: none; 
        }

        /* äº¤é€šå¡ç‰‡å°ˆå±¬æ¨£å¼ - æ¶²æ…‹ç»ç’ƒ */
        .transport-card {
            background: rgba(255, 255, 255, 0.85); /* è¼•å¾®ç»ç’ƒèƒŒæ™¯ */
            backdrop-filter: blur(6px); -webkit-backdrop-filter: blur(6px);
            border: 1px solid rgba(255, 255, 255, 0.9); /* æ·ºè‰²é‚Šæ¡† */
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.05);
            
            transition: transform 0.3s ease-in-out, box-shadow 0.3s ease-in-out;
            padding: 1rem; border-radius: 0.75rem;
            position: relative;
        }

        .transport-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 20px rgba(0, 0, 0, 0.15); /* åŠ å¼·æ‡¸æµ®æ„Ÿ */
        }

        /* ----------------------- äº¤é€šç·šè·¯è¦–è¦ºå¼·åŒ– ----------------------- */
        .transport-line {
            position: relative; height: 4px; 
            background-color: #e53e3e; 
            margin-top: 10px; flex-grow: 1;
        }
        
        /* è·¯ç·šç§»å‹•ç¬¦è™Ÿå‹•ç•« - é€™äº›éƒ½å·²ç¶“æ²’æœ‰å¯¦éš›å…§å®¹ï¼Œä½†ä¿ç•™ keyframes ä»¥é˜²è¬ä¸€*/
        @keyframes travelWave {
            0% { opacity: 0; transform: translateX(-100%); }
            25% { opacity: 1; transform: translateX(0%); }
            75% { opacity: 1; transform: translateX(100%); }
            100% { opacity: 0; transform: translateX(100%); }
        }

        /* ç®­é ­å®¹å™¨ */
        .travel-wave-container {
            position: absolute; top: 50%; left: 0; right: 0; height: 100%;
            display: flex; align-items: center; justify-content: space-between;
            overflow: hidden; pointer-events: none; z-index: 5;
        }
        
        /* ç®­é ­/ç¬¦è™Ÿæœ¬é«” CSS - é›–ç„¶ HTML ç§»é™¤äº†ï¼Œä½†ä¿ç•™ CSS ç¿’æ…£ */
        .travel-symbol {
            color: #fef3c7; 
            font-size: 2rem; 
            font-weight: 700; position: absolute;
            top: 50%; transform: translateY(-50%) translateX(-50%); 
            animation: travelWave 5s ease-in-out infinite; 
            text-shadow: 0 0 5px rgba(229, 62, 62, 0.5); 
        }

        .travel-symbol:nth-child(1) { animation-delay: 0s; }
        .travel-symbol:nth-child(2) { animation-delay: 1.6s; } 
        .travel-symbol:nth-child(3) { animation-delay: 3.2s; }

        /* é£›æ©Ÿç§»å‹•ç·š */
        .flight-line {
            position: relative; height: 4px; margin-top: 10px; flex-grow: 1;
            background-image: repeating-linear-gradient(90deg, #9333ea, #9333ea 5px, transparent 5px, transparent 10px);
        }
        
        /* é£›æ©Ÿç¬¦è™Ÿ CSS - é›–ç„¶ HTML ç§»é™¤äº†ï¼Œä½†ä¿ç•™ CSS ç¿’æ…£ */
        .flight-symbol {
            position: absolute; top: 50%;
            transform: translateY(-50%) translateX(-50%);
            font-size: 1.6rem; 
            color: #c4b5fd; 
            animation: travelWave 6s ease-in-out infinite; 
        }

        .flight-symbol:nth-child(1) { animation-delay: 0s; }
        .flight-symbol:nth-child(2) { animation-delay: 2s; } 
        .flight-symbol:nth-child(3) { animation-delay: 4s; }


        /* äº¤é€šç·šè·¯é»ƒè‰²æ¨™ç±¤ */
        .transport-label {
            position: absolute; top: 50%; left: 50%; 
            transform: translate(-50%, -50%); white-space: nowrap;
            padding: 4px 12px; border-radius: 9999px; font-size: 0.8rem; font-weight: 700;
            background-color: #fef08a; /* äº®é»ƒè‰²èƒŒæ™¯ */
            color: #854d0e; /* æ·±æ£•è‰²æ–‡å­— */
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.2); 
            max-width: 90%; text-overflow: ellipsis; overflow: hidden;
            z-index: 10;
        }

        /* è·¯ç·šåœ–æ¨£å¼ (Timeline) - å…§å®¹å¡ç‰‡ - æ¶²æ…‹ç»ç’ƒ */
        .timeline-content-card {
            /* è®“èƒŒæ™¯é¡è‰²è®ŠæˆåŠé€æ˜ï¼Œä¸¦åŠ ä¸Šæ¨¡ç³Šæ•ˆæœ */
            background: rgba(255, 255, 255, 0.75); 
            backdrop-filter: blur(8px);
            -webkit-backdrop-filter: blur(8px);
            transition: all 0.3s ease;
            position: relative; 
            overflow: visible; 
        }
        
        /* ----------------------- å®¢è£½åŒ– Modal æ¨£å¼ ----------------------- */
        .modal-overlay {
            position: fixed;
            top: 0; left: 0; right: 0; bottom: 0;
            background-color: rgba(0, 0, 0, 0.6); /* æ·±è‰²èƒŒæ™¯ */
            backdrop-filter: blur(5px);
            -webkit-backdrop-filter: blur(5px);
            z-index: 1000;
            display: none; /* é è¨­éš±è— */
            justify-content: center;
            align-items: center;
            opacity: 0;
            transition: opacity 0.3s ease;
        }
        .modal-overlay.show {
            display: flex;
            opacity: 1;
        }
        .modal-content {
            background-color: rgba(255, 255, 255, 0.9); /* æ¶²æ…‹ç»ç’ƒæ·ºè‰²èƒŒæ™¯ */
            padding: 2rem;
            border-radius: 1rem;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.3), 0 0 10px #e53e3e; /* å¸¶æœ‰æ¥“ç´…å…‰æšˆ */
            max-width: 400px;
            width: 90%;
            transform: scale(0.9);
            transition: transform 0.3s cubic-bezier(0.175, 0.885, 0.32, 1.275);
        }
        .modal-overlay.show .modal-content {
            transform: scale(1);
        }
        /* ----------------------- å…¶ä»–æ¨£å¼ç¶­æŒä¸è®Š ----------------------- */
        .main-container {
            margin-left: 0; 
            padding-top: 6rem; 
            transition: none; 
            min-height: 100vh;
            display: flex; flex-direction: column; align-items: center; justify-content: flex-start; 
            padding-bottom: 4rem; 
        }
        
        #itinerary-content.show {
            opacity: 1; transform: translateY(0); display: block;
        }

        .timeline-container { position: relative; margin-top: 2rem; }
        /* è®“ç·šæ¢æœ‰éæ¸¡æ•ˆæœï¼Œé€™æ¨£å®ƒä¼¸é•·ç¸®çŸ­æ™‚æœƒæ¯”è¼ƒå¹³æ»‘ */
        .timeline-line { position: absolute; left: 23px; top: 24px; width: 2px; background-color: #fed7aa; z-index: 0; transition: height 0.5s ease-in-out; } 
        .timeline-item { position: relative; padding-left: 4.5rem; padding-bottom: 2.5rem; min-height: 6rem; }
        .timeline-icon {
            position: absolute; left: 0; top: 0; width: 3rem; height: 3rem; background-color: white;
            border-radius: 1rem; border: 2px solid #fed7aa; box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1);
            display: flex; align-items: center; justify-content: center; z-index: 10; transition: transform 0.3s ease-in-out;
        }
        .timeline-item:hover .timeline-icon { transform: scale(1.1) rotate(-5deg); border-color: #fca5a5; }

        .timeline-time-box {
            position: absolute; top: -0.85rem; left: 1rem; padding: 2px 12px;
            background-color: #fef08a; border-radius: 9999px; font-weight: 700;
            font-size: 0.85rem; color: #854d0e; z-index: 20; box-shadow: 0 2px 4px rgba(0,0,0,0.08);
        }

        /* æ”¶åˆå…§å®¹å‹•ç•« */
        .collapsible-content { 
            overflow: hidden; 
            transition: max-height 0.5s cubic-bezier(0.175, 0.885, 0.32, 1.275);
        }
        .toggle-icon { transition: transform 0.3s; }
        .accordion-header.active .toggle-icon { transform: rotate(180deg); }
    </style>
</head>
<body class="min-h-screen">
    <!-- æ¥“è‘‰é£„è½å®¹å™¨ -->
    <div id="maple-fall-container" class="maple-fall-container"></div>
    
    <!-- å´é‚Šæ¬„ (Side Menu) - ç¾åœ¨æ˜¯é ‚éƒ¨å°èˆªåˆ— (å·²å¥—ç”¨æ¶²æ…‹ç»ç’ƒæ•ˆæœ) -->
    <nav id="sidebar">
        <!-- Day tabs will be inserted here by JavaScript -->
    </nav>

    <!-- ä¸»å…§å®¹å€ -->
    <!-- æ³¨æ„ï¼šé€™è£¡çš„ main-container padding-top ç”¨ä¾†æ¸…é™¤ fixed çš„ sidebar -->
    <main class="main-container relative z-20 px-4">
        
        <!-- ä¸»æ¨™é¡Œå€ (å›ºå®šé¡¯ç¤ºï¼Œå°‡åœ¨åˆ‡æ›æ—¥æœŸæ™‚æ›¿æ›ç‚ºç•¶æ—¥æ‘˜è¦) -->
        <header class="text-center w-full max-w-4xl transition-all duration-500" id="main-header">
            <!-- å°é¢æ¨™é¡Œ -->
            <h1 id="main-title" class="text-5xl md:text-7xl font-extrabold leading-tight tracking-wider animated-title" style="letter-spacing: 0.1em; line-height: 1.3; white-space: nowrap;">
                <!-- Content will be inserted by JS with per-character spans -->
            </h1>
            <!-- å°é¢å‰¯æ¨™é¡Œ -->
            <p id="sub-title" class="text-xl md:text-2xl mt-6 text-gray-700 italic animated-subtitle">
                <!-- Content will be inserted by JS -->
            </p>
            <!-- æ¯æ—¥æ‘˜è¦æ¨™é¡Œ (ç”± JS å‹•æ…‹æ’å…¥) -->
        </header>

        <!-- è¡Œç¨‹å…§å®¹å€ (é»æ“Šå´é‚Šæ¬„å¾Œé¡¯ç¤º, å·²å¥—ç”¨æ¶²æ…‹ç»ç’ƒæ•ˆæœ) -->
        <div id="itinerary-content">
            <!-- Content will be inserted here by JavaScript -->
        </div>
    </main>

    <!-- å®¢è£½åŒ–ç¢ºèªè¦–çª— MODAL -->
    <div id="kobe-modal" class="modal-overlay" onclick="hideKobeModal()">
        <div class="modal-content" onclick="event.stopPropagation()">
            <h3 class="text-2xl font-bold text-red-700 mb-4 flex items-center">
                <span class="mr-2">ğŸ—ºï¸</span> ç¢ºèªå‰å¾€ç¥æˆ¶é€›è¡—è³‡è¨Šæ•´ç†
            </h3>
            <p class="text-gray-700 mb-6">é»æ“Šã€Œç¢ºèªå‰å¾€ã€å°‡åœ¨æ–°è¦–çª—ä¸­é–‹å•Ÿç¥æˆ¶å¸‚å€çš„è©³ç´°é€›è¡—è³‡è¨Šé é¢ã€‚</p>
            <div class="flex justify-end space-x-3">
                <button onclick="hideKobeModal()" class="bg-gray-300 hover:bg-gray-400 text-gray-800 font-bold py-2 px-4 rounded-lg transition-colors duration-200">
                    ç¨å¾Œå†çœ‹
                </button>
                <button onclick="navigateToKobe()" class="bg-red-500 hover:bg-red-600 text-white font-bold py-2 px-4 rounded-lg shadow-md transition-colors duration-200">
                    ç¢ºèªå‰å¾€
                </button>
            </div>
        </div>
    </div>
    <!-- MODAL END -->

    <script>
        // =================================================================
        // 1. å…¨åŸŸè®Šæ•¸å®£å‘Š
        // =================================================================
        let currentDay = null;
        // ã€æ–°å¢ã€‘ç”¨æ–¼è¿½è¹¤ä¸Šä¸€æ¬¡çš„æ»¾å‹•ä½ç½®
        let lastScrollTop = 0; 

        // =================================================================
        // 2. æ—…éŠè¡Œç¨‹è³‡æ–™ (ä¿æŒä¸è®Š)
        // =================================================================
        const itineraryData = [
            {
                day: "Day 1",
                date: "11/29(å…­)",
                theme: "å°ç£é«˜é›„ â†’ æ—¥æœ¬å¤§é˜ª â†’ é›…",
                events: [
                    { time: "12:00", type: "Preparation", action: "å‡ºé–€ â†’ è²·éº¥ç•¶å‹å¸¶å»æ©Ÿå ´", location: "é«˜é›„ (Kaohsiung)", details: ["çˆ¸çˆ¸é–‹è»Šå‰å¾€æ©Ÿå ´ã€‚"] },
                    { time: "12:30 - 15:00", type: "Procedure", action: "è¯èˆªæ«ƒæª¯å ±åˆ°ã€è¾¦ç†å‡ºå¢ƒæ‰‹çºŒ", location: "é«˜é›„åœ‹éš›æ©Ÿå ´", details: ["é ˜å–æ©Ÿç¥¨ã€æ‰˜é‹ã€å‡ºé—œã€‚"] },
                    { time: "15:25 - 19:10", type: "Flight", action: "æ­ä¹˜ä¸­è¯èˆªç©º CI176 ç­æ©Ÿ", location: "é«˜é›„åœ‹éš›æ©Ÿå ´ â†’ é—œè¥¿åœ‹éš›æ©Ÿå ´", details: ["æ™‚å·®è€ƒé‡ï¼šæ—¥æœ¬æ™‚é–“ (JST) +1 å°æ™‚ã€‚"], isImportant: true }, 
                    { time: "19:10 - 19:40", type: "Procedure", action: "è¾¦ç†å…¥å¢ƒæ‰‹çºŒ", location: "é—œè¥¿åœ‹éš›æ©Ÿå ´", details: ["å•Ÿç”¨ eSIMã€‚", "è¾¦ç† VJW (Visit Japan Web) æ‰‹çºŒã€‚"] },
                    { time: "19:40 - 20:40", type: "Action", action: "JRç¶ è‰²çª—å£è³¼è²·ç¥¨åˆ¸åŠICå¡åŠ å€¼", location: "é—œè¥¿åœ‹éš›ç©ºæ¸¯é§…", details: ["è³¼è²·ã€Œé—œè¥¿å»£åŸŸå‘¨éŠåˆ¸ã€ã€‚", "é ˜å–å·²åŠƒä½è»Šç¥¨ã€‚", "ICå¡åŠ å€¼ä¸¦è³¼è²·ç°¡å–®é£Ÿç‰©ã€‚"], isImportant: true, activityType: "æ‰‹çºŒè¾¦ç†" },
                    { time: "20:46 - 22:03", type: "Transport", method: "JR ç‰¹æ€¥", number: "HARUKA 56è™Ÿ", cost: "Â¥2200 (å«å‘¨éŠåˆ¸å…§)", duration: "ç´„ 1 å°æ™‚ 17 åˆ†é˜", steps: [{ from: "é–¢è¥¿ç©ºæ¸¯é§…", to: "äº¬éƒ½é§…", serviceName: "HARUKA", serviceNumber: "56è™Ÿ", direction: "å¾€ äº¬éƒ½", transfer: { isTransfer: false } }], isImportant: true },
                    { time: "22:10 - 22:20", type: "Transport", method: "åœ°éµ", number: "çƒä¸¸ç·š", cost: "Â¥220", duration: "ç´„ 10 åˆ†é˜", steps: [{ from: "äº¬éƒ½é§…", to: "äº”æ¡é§…", serviceName: "çƒä¸¸ç·š", serviceNumber: "", direction: "å¾€ å›½éš›ä¼šé¤¨", transfer: { isTransfer: false } }] },
                    { time: "22:20 - 22:35", type: "Action", action: "æ­¥è¡Œè‡³ä½å®¿åœ°é»ã€Œé›…ã€", location: "äº”æ¡é§… â†’ é›…", details: ["æ­¥è¡Œç´„ 15 åˆ†é˜ã€‚", "éœ€ææ—©èˆ‡æ°‘å®¿è¯çµ¡ï¼Œå‘ŠçŸ¥å…¥ä½æ™‚é–“å°‡è¶…é 22:00ã€‚"], activityType: "å…¥ä½" },
                    { time: "22:35", type: "Action", action: "å…¥ä½é£¯åº—", location: "é›… (Miyabi)", details: ["æœ¬æ—¥ä½å®¿ï¼šé›…ã€‚"] },
                ]
            },
            {
                day: "Day 2",
                date: "11/30(æ—¥)",
                theme: "è²´èˆ¹ç¥ç¤¾ â†’ éé¦¬å¯º â†’ å®‡æ²»æ•£ç­–",
                events: [
                    { time: "06:15 - 06:30", type: "Movement", action: "æ­¥è¡Œ", location: "é›… â†’ æ¸…æ°´äº”æ¡é§…", details: [] },
                    { time: "06:30 - 06:56", type: "Transport", method: "åœ°éµ", number: "äº¬é˜ªæœ¬ç·š æº–æ€¥è¡Œ", cost: "Â¥280", duration: "ç´„ 26 åˆ†é˜", steps: [{ from: "æ¸…æ°´äº”æ¡é§…", to: "å‡ºç”ºæŸ³é§…", serviceName: "äº¬é˜ªæœ¬ç·š", serviceNumber: "æº–æ€¥è¡Œ", direction: "å¾€ å‡ºç”ºæŸ³", transfer: { isTransfer: false, note: "7:17 ç­æ¬¡ç‚ºè§€å…‰åˆ—è»Š KIRARAã€‚" } }] },
                    { time: "07:17 - 07:47", type: "Transport", method: "é›»éµ", number: "å¡å±±é›»éµæœ¬ç·š", cost: "Â¥470", duration: "ç´„ 30 åˆ†é˜", steps: [{ from: "å‡ºç”ºæŸ³é§…", to: "è²´èˆ¹å£é§…", serviceName: "å¡å±±é›»éµæœ¬ç·š", serviceNumber: "", direction: "å¾€ éé¦¬", transfer: { isTransfer: false } }] },
                    { time: "07:47 - 08:00", type: "Movement", action: "è½‰ä¹˜å…¬è»Š", location: "è²´èˆ¹å£é§…å‰", details: ["æ­¥è¡Œç´„ 4 åˆ†é˜è‡³å…¬è»Šç«™ã€‚"] },
                    { time: "08:00 - 08:05", type: "Transport", method: "å…¬è»Š", number: "äº¬éƒ½ãƒã‚¹ 33è™Ÿ", cost: "Â¥200", duration: "ç´„ 5 åˆ†é˜", steps: [{ from: "å¡é›»è²´èˆ¹å£é§…å‰", to: "è²´èˆ¹é§…", serviceName: "33è™Ÿå…¬è»Š", serviceNumber: "", direction: "å¾€ è²´èˆ¹", transfer: { isTransfer: false } }] },
                    { time: "08:05 - 10:00", type: "Activity", action: "åƒè§€è²´èˆ¹ç¥ç¤¾ (é–€ç¥¨ Â¥700)", location: "è²´èˆ¹ç¥ç¤¾", details: ["é–€ç¥¨ Â¥700ã€‚", "ç¥ç¤¾æ°´ç±¤ Â¥200/äººã€‚", "å·åºŠä½å¯èƒ½å¤šæ”¶ Â¥500ã€‚"], isImportant: true, activityType: "è³æ¥“/åƒæ‹œ" },
                    { time: "10:00 - 10:15", type: "Transport", method: "å…¬è»Š", number: "äº¬éƒ½ãƒã‚¹ 33è™Ÿ", cost: "Â¥200", duration: "ç´„ 15 åˆ†é˜", steps: [{ from: "è²´èˆ¹", to: "å¡é›»è²´èˆ¹å£é§…å‰", serviceName: "33è™Ÿå…¬è»Š", serviceNumber: "", direction: "å¾€ å¡é›»è²´èˆ¹å£é§…å‰", transfer: { isTransfer: false } }] },
                    { time: "10:30 - 11:00", type: "Transport", method: "é›»éµ", number: "å¡å±±é›»éµæœ¬ç·š", cost: "Â¥220", duration: "ç´„ 30 åˆ†é˜", steps: [{ from: "è²´èˆ¹å£é§…", to: "éé¦¬é§…", serviceName: "å¡å±±é›»éµæœ¬ç·š", serviceNumber: "", direction: "å¾€ éé¦¬", transfer: { isTransfer: false } }] },
                    { time: "11:00 - 12:00", type: "Lunch", action: "åˆé¤ï¼šNagomiya Kotengu", location: "éé¦¬å¯ºé™„è¿‘", details: ["æ­¥è¡Œç´„ 10 åˆ†é˜ã€‚"] },
                    { time: "12:00 - 13:00", type: "Activity", action: "åƒè§€éé¦¬å¯º (é–€ç¥¨ Â¥300) èˆ‡æ­ä¹˜çºœè»Š", location: "éé¦¬å¯º", details: ["é–€ç¥¨ Â¥300ã€‚", "çºœè»Š Â¥200ã€‚"], isImportant: true, activityType: "åƒæ‹œ" },
                    { time: "13:00 - 14:13", type: "Transport", method: "å¤šæ®µè½‰ä¹˜", number: "é›»éµ/äº¬é˜ª/JRå¥ˆè‰¯ç·š", cost: "Â¥470 + å»£åŸŸåˆ¸", duration: "ç´„ 1 å°æ™‚ 13 åˆ†é˜", steps: [{ from: "éé¦¬é§…", to: "å‡ºç”ºæŸ³é§…", serviceName: "å¡å±±é›»éµæœ¬ç·š", serviceNumber: "", direction: "å¾€ å‡ºç”ºæŸ³", transfer: { isTransfer: true, station: "å‡ºç”ºæŸ³é§…" } }, { from: "å‡ºç”ºæŸ³é§…", to: "æ±ç¦å¯ºé§…", serviceName: "äº¬é˜ªæœ¬ç·š", serviceNumber: "", direction: "å¾€ æ·€å±‹æ©‹", transfer: { isTransfer: true, station: "æ±ç¦å¯ºé§…" } }, { from: "æ±ç¦å¯ºé§…", to: "å®‡æ²»é§…", serviceName: "JRå¥ˆè‰¯ç·š", serviceNumber: "", direction: "å¾€ åŸé™½/å¥ˆè‰¯", transfer: { isTransfer: false, note: "å»£åŸŸåˆ¸æ­ä¹˜" } }], isImportant: true },
                    { time: "14:13 - 14:23", type: "Movement", action: "æ­¥è¡Œè‡³ ä¸­æ‘è—¤å‰(å¹³ç­‰é™¢åº—)", location: "å®‡æ²»é§… â†’ ä¸­æ‘è—¤å‰", details: ["é ˜å–è™Ÿç¢¼ç‰Œã€‚"] },
                    { time: "14:23 - 17:30", type: "Activity", action: "åƒè§€å®‡æ²»ç¥ç¤¾ã€å®‡æ²»å…¬åœ’", location: "å®‡æ²»", details: ["å®‡æ²»ç¥ç¤¾", "å®‡æ²»å…¬åœ’", "17:30 æ–¼å¹³ç­‰é™¢ç­‰å¾…å¤œé–“æ‹è¦³ã€‚"], activityType: "åƒæ‹œ/æ•£ç­–" },
                    { time: "17:30 - 19:20", type: "Activity", action: "å¹³ç­‰é™¢å¤œé–“ç‰¹åˆ¥æ‹è¦³ (Â¥2200)", location: "å¹³ç­‰é™¢", details: ["é–€ç¥¨ Â¥700 + å¤œé–“ Â¥1500ã€‚"], isImportant: true, activityType: "ç‰¹åˆ¥æ‹è¦³" },
                    { time: "19:20 - 19:50", type: "Dinner", action: "æ™šé¤ï¼šå®‡æ²»å‘¨é‚Š", location: "å®‡æ²»", details: ["å°‹æ‰¾åœ¨åœ°ç¾é£Ÿã€‚"] },
                    { time: "19:50 - 20:00", type: "Transport", method: "å¤šæ®µè½‰ä¹˜", number: "JRå¥ˆè‰¯ç·š + äº¬é˜ªæœ¬ç·š", cost: "å»£åŸŸåˆ¸ + Â¥280", duration: "ç´„ 30 åˆ†é˜", steps: [{ from: "å®‡æ²»é§…", to: "æ±ç¦å¯ºé§…", serviceName: "JRå¥ˆè‰¯ç·š", serviceNumber: "", direction: "å¾€ äº¬éƒ½", transfer: { isTransfer: true, station: "æ±ç¦å¯ºé§…" } }, { from: "æ±ç¦å¯ºé§…", to: "æ¸…æ°´äº”æ¡é§…", serviceName: "äº¬é˜ªæœ¬ç·š", serviceNumber: "", direction: "å¾€ å‡ºç”ºæŸ³", transfer: { isTransfer: false } }] },
                    { time: "20:00", type: "Action", action: "å›åˆ°ä½å®¿åœ°é»ã€Œé›…ã€", location: "é›…", details: [] },
                ]
            },
            {
                day: "Day 3",
                date: "12/1(ä¸€)",
                theme: "æ¸…æ°´å¯ºè³æ¥“ â†’ éŠ€é–£å¯º â†’ å“²å­¸ä¹‹é“ â†’ å’Œæ­Œå±±",
                events: [
                    { time: "06:00 - 06:30", type: "Movement", action: "æ­¥è¡Œè‡³æ¸…æ°´å¯º", location: "é›… â†’ æ¸…æ°´å¯º", details: ["è·¯ç¨‹ç´„ 26 åˆ†é˜ã€‚"] },
                    { time: "06:30 - 09:20", type: "Activity", action: "åƒè§€æ¸…æ°´å¯º (é–€ç¥¨ Â¥500)", location: "æ¸…æ°´å¯º", details: ["é–€ç¥¨ Â¥500ã€‚", "æ¸…æ°´èˆå°è³æ¥“ã€‚"], isImportant: true, activityType: "è³æ¥“/åƒæ‹œ" },
                    { time: "09:20 - 09:48", type: "Transport", method: "å…¬è»Š", number: "EX100 City Bus", cost: "Â¥500", duration: "ç´„ 28 åˆ†é˜", steps: [{ from: "äº”æ¡å‚", to: "éŠ€é–£å¯ºå‰", serviceName: "EX100 City Bus", serviceNumber: "", direction: "å¾€ éŠ€é–£å¯ºå‰", transfer: { isTransfer: false } }] },
                    { time: "09:48 - 12:30", type: "Activity", action: "éŠ€é–£å¯ºã€å“²å­¸ä¹‹é“ã€æ°¸è§€å ‚", location: "éŠ€é–£å¯º â†’ å—ç¦ªå¯º", details: ["éŠ€é–£å¯ºé–€ç¥¨ Â¥500ã€‚", "æ°¸è§€å ‚é–€ç¥¨ Â¥600ã€‚", "å“²å­¸ä¹‹é“æ•£ç­–ã€‚"], isImportant: true, activityType: "è³æ¥“" },
                    { time: "12:30 - 14:00", type: "Lunch", action: "åˆé¤ï¼šäº¬çƒé¾éºµã”ã‚“å¤ª", location: "å“²å­¸ä¹‹è·¯", details: ["ä¼‘æ¯å–å’–å•¡ã€‚"] },
                    { time: "14:00 - 14:30", type: "Activity", action: "åƒè§€å—ç¦ªå¯º", location: "å—ç¦ªå¯º", details: [] },
                    { time: "14:30 - 14:50", type: "Transport", method: "å…¬è»Š", number: "5 City Bus", cost: "Â¥230", duration: "ç´„ 20 åˆ†é˜", steps: [{ from: "å—ç¦ªå¯º", to: "å››æ¢æ²³åŸç”º", serviceName: "5 City Bus", serviceNumber: "", direction: "å¾€ å››æ¢æ²³åŸç”º", transfer: { isTransfer: false } }] },
                    { time: "14:50 - 17:00", type: "Shopping", action: "å››æ¢æ²³åŸç”ºé€›è¡—", location: "å››æ¢æ²³åŸç”º", details: ["OS Drug Store", "kiddy land", "Yojiya", "RABBIT BAGELS"], activityType: "è³¼ç‰©" },
                    { time: "17:00 - 17:20", type: "Movement", action: "å›æ°‘å®¿å–è¡Œæ", location: "é›…", details: [] },
                    { time: "17:20 - 17:47", type: "Transport", method: "åœ°éµ", number: "çƒä¸¸ç·š", cost: "Â¥220", duration: "ç´„ 27 åˆ†é˜", steps: [{ from: "äº”æ¡é§…", to: "äº¬éƒ½é§…", serviceName: "çƒä¸¸ç·š", serviceNumber: "", direction: "å¾€ ç«¹ç”°", transfer: { isTransfer: false } }] },
                    { time: "17:47 - 19:23", type: "Transport", method: "JR ç‰¹æ€¥", number: "é»’æ½®ç‰¹æ€¥ãã‚ã—ãŠ", cost: "å»£åŸŸåˆ¸", duration: "ç´„ 1 å°æ™‚ 36 åˆ†é˜", steps: [{ from: "äº¬éƒ½é§…", to: "å’Œæ­Œå±±é§…", serviceName: "é»’æ½®ç‰¹æ€¥", serviceNumber: "ãã‚ã—ãŠ", direction: "å¾€ ç™½æ¿±", transfer: { isTransfer: false } }], isImportant: true },
                    { time: "19:23 - 19:40", type: "Action", action: "æ­¥è¡Œè‡³é£¯åº—", location: "å’Œæ­Œå±±é§… â†’ å¤šç¾è¿", details: [] },
                    { time: "19:40 - 21:00", type: "Dinner", action: "æ™šé¤ï¼šå’Œæ­Œå±±é§…å‘¨é‚Š", location: "å’Œæ­Œå±±é§…", details: [] },
                    { time: "21:00", type: "Action", action: "å…¥ä½é£¯åº—", location: "å¤šç¾è¿ Premium å’Œæ­Œå±±", details: ["æœ¬æ—¥ä½å®¿ï¼šå¤šç¾è¿ Premium å’Œæ­Œå±±ã€‚"] },
                ]
            },
            {
                day: "Day 4",
                date: "12/2(äºŒ)",
                theme: "é‚£æ™º â†’ é‚£æ™ºç€‘å¸ƒ",
                events: [
                    { time: "08:20", type: "Movement", action: "æ­¥è¡Œå‰å¾€å’Œæ­Œå±±é§…", location: "é£¯åº— â†’ å’Œæ­Œå±±é§…", details: ["å‡ºç™¼å‰è²·åˆé¤ã€‚"] },
                    { time: "08:48 - 11:40", type: "Transport", method: "JR ç‰¹æ€¥", number: "é»’æ½®è™Ÿ (ãã‚ã—ãŠ 1)", cost: "Â¥6140", duration: "ç´„ 2 å°æ™‚ 52 åˆ†é˜", steps: [{ from: "å’Œæ­Œå±±é§…", to: "ç´€ä¼Šå‹æµ¦é§…", serviceName: "é»’æ½®è™Ÿ", serviceNumber: "ãã‚ã—ãŠ 1", direction: "å¾€ æ–°å®®", transfer: { isTransfer: false } }], isImportant: true },
                    { time: "11:50 - 12:08", type: "Transport", method: "å…¬è»Š", number: "å—æµ·å·´å£«31ç·š", cost: "Â¥430", duration: "ç´„ 18 åˆ†é˜", steps: [{ from: "ç´€ä¼Šå‹æµ¦é§…", to: "äºŒã®ç€¬æ©‹", serviceName: "å—æµ·å·´å£«31ç·š", serviceNumber: "", direction: "å¾€ é‚£æ™ºå±±", transfer: { isTransfer: false } }] },
                    { time: "12:20 - 13:00", type: "Lunch", action: "åˆé¤ï¼šGrill Ikk", location: "äºŒã®ç€¬æ©‹", details: [] },
                    { time: "13:00 - 13:15", type: "Action", action: "å¤§é–€å‚èŒ¶å±‹æ›è£", location: "å¤§é–€å‚èŒ¶å±‹", details: ["å¹³å®‰æœè£é«”é©—ã€‚"] },
                    { time: "13:30 - 14:00", type: "Activity", action: "åƒè§€é‚£æ™ºå¤§ç¤¾ã€é’å²¸æ¸¡å¯º", location: "é‚£æ™ºå¤§ç¤¾", details: ["éƒ¨åˆ†é–€ç¥¨ Â¥300ã€‚", "å¤«å©¦æ‰æ‹ç…§ã€‚"], isImportant: true, activityType: "åƒæ‹œ" },
                    { time: "15:00 - 15:20", type: "Activity", action: "è§€è³é‚£æ™ºç€‘å¸ƒ", location: "é£›ç€§ç¥ç¤¾", details: ["é–€ç¥¨ Â¥300ã€‚"] },
                    { time: "15:20 - 15:30", type: "Transport", method: "å…¬è»Š", number: "å—æµ·å·´å£«31ç·š", cost: "Â¥200", duration: "ç´„ 10 åˆ†é˜", steps: [{ from: "é‚£æ™ºç€‘å¸ƒ", to: "ç†Šé‡å¤é“ç«™", serviceName: "å—æµ·å·´å£«31ç·š", serviceNumber: "", direction: "å¾€ ç´€ä¼Šå‹æµ¦é§…", transfer: { isTransfer: false } }] },
                    { time: "15:50 - 16:31", type: "Action", action: "æ›å›ä¾¿æœ", location: "å¤§é–€å‚èŒ¶å±‹", details: [] },
                    { time: "16:32 - 16:53", type: "Transport", method: "å…¬è»Š", number: "å—æµ·å·´å£«31ç·š", cost: "Â¥540", duration: "ç´„ 21 åˆ†é˜", steps: [{ from: "ç†Šé‡å¤é“ç«™", to: "ç´€ä¼Šå‹æµ¦é§…", serviceName: "å—æµ·å·´å£«31ç·š", serviceNumber: "", direction: "å¾€ ç´€ä¼Šå‹æµ¦é§…", transfer: { isTransfer: false } }] },
                    { time: "17:00 - 17:50", type: "Dinner", action: "æ™šé¤ï¼šè»Šç«™é™„è¿‘", location: "ç´€ä¼Šå‹æµ¦é§…", details: ["æµ·é®®æ–™ç†ã€‚"] },
                    { time: "18:04 - 21:02", type: "Transport", method: "JR ç‰¹æ€¥", number: "é»’æ½®è™Ÿ (ãã‚ã—ãŠ36)", cost: "Â¥6140", duration: "ç´„ 2 å°æ™‚ 58 åˆ†é˜", steps: [{ from: "ç´€ä¼Šå‹æµ¦é§…", to: "å’Œæ­Œå±±é§…", serviceName: "é»’æ½®è™Ÿ", serviceNumber: "ãã‚ã—ãŠ36", direction: "å¾€ æ–°å¤§é˜ª", transfer: { isTransfer: false } }], isImportant: true },
                    { time: "21:02", type: "Action", action: "å›åˆ°é£¯åº—", location: "å¤šç¾è¿ Premium å’Œæ­Œå±±", details: [] },
                ]
            },
            {
                day: "Day 5",
                date: "12/3(ä¸‰)",
                theme: "å°ç‰é›»è»Š â†’ å’Œæ­Œå±±åŸ â†’ é»’æ½®å¸‚å ´",
                events: [
                    { time: "07:00 - 07:30", type: "Movement", action: "æ­¥è¡Œå‰å¾€å’Œæ­Œå±±é§…", location: "é£¯åº— â†’ å’Œæ­Œå±±é§…", details: ["æ–¼é£¯åº—å…ˆå¯„æ”¾è¡Œæã€‚"] },
                    { time: "07:30 - 08:30", type: "Transport", method: "é›»è»Š", number: "è²´å¿—å·ç·š å°ç‰é›»è»Š", cost: "å»£åŸŸåˆ¸", duration: "ç´„ 30 åˆ†é˜", steps: [{ from: "å’Œæ­Œå±±é§…", to: "ä¼Šå¤ªç¥ˆæ›½é§…", serviceName: "è²´å¿—å·ç·š", serviceNumber: "å°ç‰é›»è»Š", direction: "å¾€ è²´å¿—", transfer: { isTransfer: false } }], isImportant: true },
                    { time: "08:30 - 09:15", type: "Activity", action: "åƒè§€ä¼Šå¤ªç¥æ›½ç¥ç¤¾", location: "ä¼Šå¤ªç¥æ›½ç¥ç¤¾", details: ["å¾ä¼Šå¤ªç¥ˆæ›½é§…æ­¥è¡Œå¯é”ã€‚"], activityType: "åƒæ‹œ" },
                    { time: "09:15 - 09:45", type: "Transport", method: "é›»è»Š", number: "è²´å¿—å·ç·š å°ç‰é›»è»Š", cost: "å»£åŸŸåˆ¸", duration: "ç´„ 30 åˆ†é˜", steps: [{ from: "ä¼Šå¤ªç¥ˆæ›½é§…", to: "è²´å¿—é§…", serviceName: "è²´å¿—å·ç·š", serviceNumber: "", direction: "å¾€ è²´å¿—", transfer: { isTransfer: false } }] },
                    { time: "09:45 - 10:15", type: "Activity", action: "åƒè§€è²´å¿—é§…è²“ç«™é•·", location: "è²´å¿—é§…", details: ["è²“ç«™é•·ä¸Šç­æ™‚é–“ç´„ 10:00 å¾Œã€‚"], activityType: "è§€å…‰" },
                    { time: "10:15 - 10:45", type: "Transport", method: "é›»è»Š", number: "è²´å¿—å·ç·š å°ç‰é›»è»Š", cost: "å»£åŸŸåˆ¸", duration: "ç´„ 30 åˆ†é˜", steps: [{ from: "è²´å¿—é§…", to: "å’Œæ­Œå±±é§…", serviceName: "è²´å¿—å·ç·š", serviceNumber: "", direction: "å¾€ å’Œæ­Œå±±é§…", transfer: { isTransfer: false } }] },
                    { time: "10:45 - 11:00", type: "Transport", method: "å…¬è»Š", number: "å’Œæ­Œå±±å·´å£«30ç·š", cost: "Â¥230", duration: "ç´„ 15 åˆ†é˜", steps: [{ from: "å’Œæ­Œå±±é§…", to: "å’Œæ­Œå±±åŸå‰", serviceName: "30è™Ÿå…¬è»Š", serviceNumber: "", direction: "å¾€ é›‘è³€å´", transfer: { isTransfer: false } }] },
                    { time: "11:00 - 12:00", type: "Activity", action: "åƒè§€å’Œæ­Œå±±åŸ (é–€ç¥¨ Â¥410)", location: "å’Œæ­Œå±±åŸ", details: ["é–€ç¥¨ Â¥410ã€‚", "æ¨è–¦èŒ¶å±‹å†°æ·‡æ·‹ã€‚"], isImportant: true, activityType: "è§€å…‰" },
                    { time: "12:00 - 12:15", type: "Movement", action: "æ­¥è¡Œè‡³å’Œæ­Œå±±åŸå‰å…¬è»Šç«™", location: "å’Œæ­Œå±±åŸå‰", details: [] },
                    { time: "12:15 - 13:00", type: "Transport", method: "å…¬è»Š", number: "å’Œæ­Œå±±å·´å£«121ç·š", cost: "Â¥520", duration: "ç´„ 45 åˆ†é˜", steps: [{ from: "å’Œæ­Œå±±åŸå‰", to: "ãƒãƒªãƒ¼ãƒŠã‚·ãƒ†ã‚£", serviceName: "121è™Ÿå…¬è»Š", serviceNumber: "", direction: "å¾€ æµ·å—é§…å‰", transfer: { isTransfer: false } }] },
                    { time: "13:00 - 14:30", type: "Lunch", action: "åˆé¤ï¼šé»’æ½®å¸‚å ´", location: "é»’æ½®å¸‚å ´", details: ["é»‘é®ªé­šè¡¨æ¼”ã€‚", "Maruki éºµåŒ…ã€‚"] },
                    { time: "14:30 - 14:50", type: "Transport", method: "å…¬è»Š+çºœè»Š", number: "121ç·š+çºœè»Š", cost: "Â¥270+Â¥800", duration: "ç´„ 20 åˆ†é˜", steps: [{ from: "ãƒãƒªãƒ¼ãƒŠã‚·ãƒ†ã‚£", to: "ç´€ä¸‰äº•å¯º", serviceName: "121è™Ÿå…¬è»Š", serviceNumber: "", direction: "å¾€ JRå’Œæ­Œå±±é§…", transfer: { isTransfer: false } }] },
                    { time: "15:00 - 15:30", type: "Activity", action: "åƒè§€ç´€ä¸‰äº•å¯º", location: "ç´€ä¸‰äº•å¯º", details: [] },
                    { time: "15:30 - 15:50", type: "Transport", method: "JR ç·š", number: "ç´€ä¹‹åœ‹ç·š", cost: "å»£åŸŸåˆ¸", duration: "ç´„ 20 åˆ†é˜", steps: [{ from: "ç´€ä¸‰äº•å¯ºé§…", to: "å’Œæ­Œå±±é§…", serviceName: "ç´€ä¹‹åœ‹ç·š", serviceNumber: "", direction: "å¾€ å’Œæ­Œå±±", transfer: { isTransfer: false } }] },
                    { time: "16:50 - 17:33", type: "Transport", method: "JR ç‰¹æ€¥", number: "é»’æ½®è™Ÿ (ãã‚ã—ãŠ 26)", cost: "Â¥2630", duration: "ç´„ 43 åˆ†é˜", steps: [{ from: "å’Œæ­Œå±±é§…", to: "å¤©ç‹å¯ºé§…", serviceName: "é»’æ½®è™Ÿ", serviceNumber: "26è™Ÿ", direction: "å¾€ æ–°å¤§é˜ª", transfer: { isTransfer: true, station: "å¤©ç‹å¯º" } }] },
                    { time: "17:33 - 17:50", type: "Transport", method: "JR+åœ°éµ", number: "é—œè¥¿æœ¬ç·š+å¾¡å ‚ç­‹ç·š", cost: "Â¥220", duration: "ç´„ 17 åˆ†é˜", steps: [{ from: "å¤©ç‹å¯º", to: "é›£æ³¢é§…", serviceName: "é—œè¥¿æœ¬ç·š", serviceNumber: "", direction: "å¾€ JRé›£æ³¢", transfer: { isTransfer: false } }] },
                    { time: "17:50", type: "Action", action: "å…¥ä½é£¯åº—", location: "APA Hotel å¤§é˜ªé›£æ³¢ç«™å‰å¡”", details: ["æœ¬æ—¥ä½å®¿ã€‚"] },
                ]
            },
            {
                day: "Day 6",
                date: "12/4(å››)",
                theme: "å‹å°¾å¯º â†’ ç®•é¢è±é‡ â†’ æ¢…ç”° â†’ é“é “å €",
                events: [
                    { time: "08:11 - 08:47", type: "Transport", method: "åœ°éµ", number: "å¾¡å ‚ç­‹ç·š/åŒ—å¤§é˜ªæ€¥è¡Œç·š", cost: "Â¥530", duration: "ç´„ 36 åˆ†é˜", steps: [{ from: "é›£æ³¢ç«™", to: "ç®•é¢è±é‡é§…", serviceName: "å¾¡å ‚ç­‹ç·š", serviceNumber: "", direction: "å¾€ ç®•é¢è±é‡", transfer: { isTransfer: false } }] },
                    { time: "09:00 - 09:30", type: "Transport", method: "å…¬è»Š", number: "é˜ªæ€¥å·´å£«30ç·š", cost: "Â¥800", duration: "ç´„ 30 åˆ†é˜", steps: [{ from: "ç®•é¢è±é‡", to: "å‹å°¾å¯º", serviceName: "é˜ªæ€¥å·´å£«30ç·š", serviceNumber: "", direction: "å¾€ å‹å°¾å¯º", transfer: { isTransfer: false } }] },
                    { time: "09:30 - 11:50", type: "Activity", action: "åƒè§€å‹å°¾å¯º (é–€ç¥¨ Â¥500)", location: "å‹å°¾å¯º", details: ["é”æ‘©ä¸å€’ç¿ã€‚", "è“‹ç« å·¡ç¦®ã€‚"], isImportant: true, activityType: "åƒæ‹œ" },
                    { time: "11:50 - 12:11", type: "Transport", method: "å…¬è»Š", number: "é˜ªæ€¥å·´å£«30ç·š", cost: "Â¥800", duration: "ç´„ 21 åˆ†é˜", steps: [{ from: "å‹å°¾å¯º", to: "ç®•é¢è±é‡", serviceName: "é˜ªæ€¥å·´å£«30ç·š", serviceNumber: "", direction: "å¾€ ç®•é¢è±é‡", transfer: { isTransfer: false } }] },
                    { time: "12:11 - 12:43", type: "Transport", method: "åœ°éµ", number: "åŒ—å¤§é˜ªæ€¥è¡Œç·š", cost: "Â¥480", duration: "ç´„ 32 åˆ†é˜", steps: [{ from: "ç®•é¢è±é‡", to: "æ¢…ç”°ç«™", serviceName: "å¾¡å ‚ç­‹ç·š", serviceNumber: "", direction: "å¾€ ä¸­ç™¾èˆŒé³¥", transfer: { isTransfer: false } }] },
                    { time: "13:00 - 17:30", type: "Shopping", action: "æ¢…ç”°é€›è¡—", location: "æ¢…ç”°", details: ["é˜ªæ€¥ä¸‰ç•ªè¡—", "Loft", "LUCUA", "å‹éƒ½å…«å–œ"], activityType: "è³¼ç‰©" },
                    { time: "17:37 - 17:53", type: "Transport", method: "åœ°éµ", number: "å¾¡å ‚ç­‹ç·š", cost: "Â¥240", duration: "ç´„ 16 åˆ†é˜", steps: [{ from: "æ¢…ç”°ç«™", to: "é›£æ³¢ç«™", serviceName: "å¾¡å ‚ç­‹ç·š", serviceNumber: "", direction: "å¾€ ä¸­ç™¾èˆŒé³¥", transfer: { isTransfer: false } }] },
                    { time: "18:00 - 21:00", type: "Dinner", action: "æ™šé¤ï¼šé“é “å €", location: "é“é “å €", details: ["å¤§èµ·æ°´ç”¢è¿´è½‰å£½å¸ã€‚"] },
                    { time: "21:00", type: "Shopping", action: "Life è¶…å¸‚", location: "é›£æ³¢", details: ["è²·æ°´æœé›¶é£Ÿã€‚"] },
                ]
            },
            {
                day: "Day 7",
                date: "12/5(äº”)",
                theme: "ç¥æˆ¶å¸ƒå¼•é¦™è‰åœ’ â†’ æ‘©è€¶å±±å¤œæ™¯",
                events: [
                    { time: "08:00 - 09:06", type: "Transport", method: "é›»è»Š", number: "é˜ªç¥é›£æ³¢ç·š", cost: "Â¥630", duration: "ç´„ 1 å°æ™‚", steps: [{ from: "å¤§é˜ªé›£æ³¢", to: "ç¥æˆ¸ä¸‰å®®", serviceName: "é˜ªç¥é›£æ³¢ç·š", serviceNumber: "", direction: "å¾€ ç¥æˆ¸ä¸‰å®®", transfer: { isTransfer: true, station: "ä¸‰å®®è½‰åœ°éµ" } }, { from: "ä¸‰å®®", to: "æ–°ç¥æˆ¶", serviceName: "è¥¿ç¥å±±æ‰‹ç·š", serviceNumber: "", direction: "å¾€ æ–°ç¥æˆ¶", transfer: { isTransfer: false } }], isImportant: true },
                    { time: "09:40 - 11:30", type: "Activity", action: "ç¥æˆ¶å¸ƒå¼•é¦™è‰åœ’ (å¥—ç¥¨ Â¥4500)", location: "é¦™è‰åœ’", details: ["å«çºœè»Šè²»ç”¨ã€‚"], activityType: "è§€å…‰" },
                    { time: "11:40 - 15:50", type: "Shopping", action: "ç¥æˆ¶å¸‚å€æ•£ç­–", location: "ä¸‰å®®/å…ƒç”º/æ¸¯å€", details: ["ç”Ÿç”°ç¥ç¤¾", "å…ƒç”ºå•†åº—è¡—", "ç¥æˆ¶æ¸¯å¡”", "éºµåŒ…è¶…äººåšç‰©é¤¨"], activityType: "è§€å…‰" },
                    { time: "16:35 - 17:05", type: "Transport", method: "çºœè»Š", number: "æ‘©è€¶å±±çºœè»Š", cost: "Â¥1560(ä¾†å›)", duration: "ç´„ 30 åˆ†é˜", steps: [{ from: "ç‘ªé›…é›»çºœç«™", to: "æ˜Ÿä¹‹ç«™", serviceName: "æ‘©è€¶çºœè»Š", serviceNumber: "", direction: "å¾€ å±±é ‚", transfer: { isTransfer: false } }], isImportant: true },
                    { time: "17:05 - 18:10", type: "Activity", action: "æ‘©è€¶å±±æ¬æ˜Ÿå°å¤œæ™¯", location: "æ‘©è€¶å±±", details: ["æ—¥æœ¬ä¸‰å¤§å¤œæ™¯ã€‚"], isImportant: true, activityType: "å¤œæ™¯" },
                    { time: "18:10 - 19:02", type: "Transport", method: "çºœè»Š+å…¬è»Š", number: "ä¸‹å±±", cost: "Â¥230", duration: "ç´„ 52 åˆ†é˜", steps: [{ from: "æ˜Ÿä¹‹ç«™", to: "ä¸‰å®®", serviceName: "å…¬è»Š2ç³»çµ±", serviceNumber: "", direction: "å¾€ ä¸‰å®®", transfer: { isTransfer: false } }] },
                    { time: "20:00 - 20:42", type: "Transport", method: "é›»è»Š", number: "é˜ªç¥æœ¬ç·š", cost: "Â¥330", duration: "ç´„ 42 åˆ†é˜", steps: [{ from: "ç¥æˆ¸ä¸‰å®®", to: "å¤§é˜ªæ¢…ç”°", serviceName: "é˜ªç¥æœ¬ç·š", serviceNumber: "", direction: "å¾€ æ¢…ç”°", transfer: { isTransfer: false } }] },
                    { time: "20:42 - 21:04", type: "Transport", method: "åœ°éµ", number: "å››æ©‹ç·š", cost: "Â¥240", duration: "ç´„ 22 åˆ†é˜", steps: [{ from: "è¥¿æ¢…ç”°", to: "é›£æ³¢", serviceName: "å››æ©‹ç·š", serviceNumber: "", direction: "å¾€ ä½ä¹‹æ±Ÿå…¬åœ’", transfer: { isTransfer: false } }] },
                ]
            },
            {
                day: "Day 8",
                date: "12/6(å…­)",
                theme: "é›£æ³¢æ•£ç­– â†’ è¿”ç¨‹",
                events: [
                    { time: "08:15 - 09:30", type: "Lunch", action: "æ—©é¤ï¼šä¸¸ç¦å’–å•¡åº—", location: "åƒæ—¥å‰æœ¬åº—", details: [] },
                    { time: "09:50 - 11:00", type: "Activity", action: "åƒè§€å…«æ¿ç¥ç¤¾", location: "å…«æ¿ç¥ç¤¾", details: ["ç…å­æ®¿ã€‚"], activityType: "åƒæ‹œ" },
                    { time: "11:00 - 13:30", type: "Shopping", action: "é›£æ³¢ City é€›è¡—", location: "é›£æ³¢ City", details: ["MUJI", "mont-bell"], activityType: "è³¼ç‰©" },
                    { time: "13:30 - 14:30", type: "Lunch", action: "åˆé¤ï¼špiccoLoå’–å–±", location: "NAMBA WALKåº—", details: ["åšåšä»–å€‘çš„æ‹›ç‰Œå’–å“©ï¼"] },
                    { time: "14:30 - 15:50", type: "Shopping", action: "Life è¶…å¸‚è³¼è²·é›¶é£Ÿ", location: "é›£æ³¢", details: ["è¦æ³¨æ„æ˜¯å¦æœ‰é€€ç¨…æ«ƒæª¯ã€‚", "å¯é †ä¾¿æ¡è²·ä¼´æ‰‹ç¦®ã€‚"], activityType: "è³¼ç‰©" },
                    { time: "15:50 - 16:30", type: "Action", action: "è¿”å›é£¯åº—é ˜å–è¡Œæ", location: "APA Hotel å¤§é˜ªé›£æ³¢ç«™å‰å¡”", details: ["é ç•™å……è£•æ™‚é–“æ•´ç†è¡Œæï¼Œä¸¦å°‡å¤§ä»¶ç‰©å“å¯„å‡ºã€‚"], activityType: "é ˜å–è¡Œæ" },
                    { time: "16:30 - 17:00", type: "Movement", action: "æ­¥è¡Œè‡³å—æµ·é›£æ³¢ç«™", location: "å—æµ·é›£æ³¢é§…", details: ["æ­¥è¡Œç´„ 11 åˆ†é˜ï¼Œæº–å‚™æ­ä¹˜ RAPIT ç‰¹æ€¥ã€‚"] },
                    { time: "17:00 - 17:37", type: "Transport", method: "å—æµ·ç‰¹æ€¥", number: "RAPIT áº 55", cost: "Â¥1490", duration: "ç´„ 37 åˆ†é˜", steps: [{ from: "å—æµ·é›£æ³¢", to: "é—œè¥¿æ©Ÿå ´", serviceName: "RAPIT", serviceNumber: "55è™Ÿ", direction: "å¾€ æ©Ÿå ´", transfer: { isTransfer: false } }], isImportant: true },
                    { time: "20:10 - 22:45", type: "Flight", action: "æ­ä¹˜è¯èˆª C1177èˆªç­", location: "å¤§é˜ª â†’ é«˜é›„", details: ["å›å®¶å›‰ã€‚"], isImportant: true },
                ]
            }
        ];

        // =================================================================
        // 3. UI ç”¢ç”Ÿå‡½å¼
        // =================================================================

        // ã€æ–°å¢ã€‘æ—¥æœ¬æ˜ŸæœŸå°æ‡‰è¡¨
        const dayMap = {
            'æ—¥': { name: 'æ—¥æ›œæ—¥', color: 'text-red-500' },
            'ä¸€': { name: 'æœˆæ›œæ—¥', color: 'text-yellow-600' },
            'äºŒ': { name: 'ç«æ›œæ—¥', color: 'text-red-700' },
            'ä¸‰': { name: 'æ°´æ›œæ—¥', color: 'text-blue-500' },
            'å››': { name: 'æœ¨æ›œæ—¥', color: 'text-green-600' },
            'äº”': { name: 'é‡‘æ›œæ—¥', color: 'text-yellow-700' },
            'å…­': { name: 'åœŸæ›œæ—¥', color: 'text-gray-700' },
        };

        function cleanLocationName(locationString) {
            if (typeof locationString !== 'string') return "";
            return locationString.split('(')[0].trim();
        }

        function getEventIcon(type, method = '') {
            const iconClass = "w-6 h-6";
            // é£›æ©Ÿåœ–ç¤º
            if (type === 'Flight') return `<svg class="${iconClass} text-purple-500" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 19l9 2-9-18-9 18 9-2zm0 0v-8"></path></svg>`;
            // äº¤é€šåœ–ç¤º
            if (type === 'Transport') {
                // å…¬è»Šåœ–ç¤º
                if (method && (method.includes('å…¬è»Š') || method.includes('å·´å£«'))) return `<svg class="${iconClass} text-blue-500" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 7h12m0 0l-4-4m4 4l-4 4m0 6H4m0 0l4 4m-4-4l4-4"></path></svg>`;
                // ç«è»Š/é›»è»Šåœ–ç¤º
                return `<svg class="${iconClass} text-blue-600" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 16l4.586-4.586a2 2 0 012.828 0L16 16m-2-2l1.586-1.586a2 2 0 012.828 0L20 14m-6-6h.01M6 20h12a2 2 0 002-2V6a2 2 0 00-2-2H6a2 2 0 00-2 2v12a2 2 0 002 2z"></path></svg>`;
            }
            // ä¸€èˆ¬æµç¨‹/è¡Œå‹•åœ–ç¤º
            if (['Procedure','Preparation','Action','Movement'].includes(type)) return `<svg class="${iconClass} text-gray-500" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5H7a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2m-6 9l2 2 4-4"></path></svg>`;
            // é¤é£²åœ–ç¤º
            if (['Lunch','Dinner'].includes(type)) return `<svg class="${iconClass} text-orange-500" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M11 2h2M7 2h2M15 2h2M6 22h12a2 2 0 002-2V7a2 2 0 00-2-2H6a2 2 0 00-2 2v13a2 2 0 002 2z"></path></svg>`;
            // æ´»å‹•/è§€å…‰åœ–ç¤º
            if (type === 'Activity') return `<svg class="${iconClass} text-red-600" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 9a2 2 0 012-2h.93a2 2 0 001.664-.89l.812-1.22A2 2 0 0110.07 4h3.86a2 2 0 011.664.89l.812 1.22A2 2 0 0018.07 7H19a2 2 0 012 2v9a2 2 0 01-2 2H5a2 2 0 01-2-2V9z"></path></svg>`;
            // è³¼ç‰©åœ–ç¤º
            if (type === 'Shopping') return `<svg class="${iconClass} text-purple-600" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M16 11V7a4 4 0 00-8 0v4M5 9h14l1 12H4L5 9z"></path></svg>`;
            return `<svg class="${iconClass} text-gray-400" fill="none" stroke="currentColor" viewBox="0 0 24 24"><circle cx="12" cy="12" r="10"></circle></svg>`;
        }

        /**
         * æ ¹æ“šç›®å‰é¡¯ç¤ºçš„æ—¥æœŸçš„æœ€å¾Œä¸€å€‹é …ç›®ä½ç½®ï¼Œé‡æ–°è¨ˆç®—æ™‚é–“è»¸ç·šçš„é«˜åº¦ã€‚
         * @param {string} day - ç•¶å‰æ—¥æœŸ (e.g., "Day 1")
         */
        function updateTimelineHeight(day) {
            const dayData = itineraryData.find(d => d.day === day);
            if (!dayData) return;

            const lastItem = document.getElementById(`timeline-item-${dayData.events.length - 1}`);
            const line = document.getElementById(`timeline-line-${day}`);

            if (lastItem && line) {
                // offsetTop å·²ç¶“æ˜¯ç›¸å°æ–¼ timeline-container çš„ä½ç½®
                // + 24 æ˜¯è®“ç·šæ¢å»¶ä¼¸åˆ°æœ€å¾Œä¸€å€‹ icon çš„ä¸­å¿ƒé» (icon é«˜åº¦ 48px / 2 = 24px)
                const height = lastItem.offsetTop + 24; 
                line.style.height = `${height}px`;
            }
        }

        function toggleDetails(contentId) {
            const content = document.getElementById(contentId);
            if (!content) return;
            const header = content.previousElementSibling; 
            
            // å¾ contentId ä¸­æå– Day è³‡è¨Š
            const day = contentId.split('-')[0]; 

            if (content.style.maxHeight && content.style.maxHeight !== '0px') {
                // æ­£åœ¨æ”¶åˆ
                
                // ã€ä¿®æ­£ 4 - æ”¶åˆã€‘åœ¨è¨­å®š max-height ä¹‹å‰ï¼Œå°±å…ˆæ›´æ–°ç·šæ¢é«˜åº¦ï¼Œè®“ç·šæ¢è·Ÿå…§å®¹ä¸€èµ·å¹³æ»‘æ”¶ç¸®
                content.style.maxHeight = '0px';
                if(header) header.classList.remove('active');
                
                // å»¶é²æ›´æ–°ç·šæ¢é«˜åº¦ï¼Œç¢ºä¿è¦–è¦ºæ•ˆæœ
                setTimeout(() => updateTimelineHeight(day), 500); 

            } else {
                // æ­£åœ¨å±•é–‹
                content.style.maxHeight = content.scrollHeight + "px";
                if(header) header.classList.add('active');

                // ã€ä¿®æ­£ 4 - å±•é–‹ã€‘ç«‹å³æ›´æ–°ç·šæ¢é«˜åº¦ï¼Œè®“å®ƒè·Ÿè‘—å…§å®¹ä¸€èµ·ä¼¸é•·
                updateTimelineHeight(day); 
            }
        }

        function renderTransportStep(step, index, totalSteps, method, cost) {
            const isTransfer = step.transfer && step.transfer.isTransfer;
            const labelText = step.serviceName + (step.serviceNumber ? ` ${step.serviceNumber}` : '');
            let transferInfo = '';
            
            if (isTransfer) {
                transferInfo = `<p class="text-sm text-yellow-600 mt-2 font-bold flex items-center">
                    <span class="mr-1">ğŸ”„</span> è½‰ä¹˜è»Šç«™: ${cleanLocationName(step.transfer.station)}
                </p>`;
            } else if (step.transfer && step.transfer.note) {
                transferInfo = `<p class="text-xs text-gray-500 mt-2 italic">â“˜ ${step.transfer.note}</p>`;
            }
            
            // æ±ºå®šæ˜¯äº¤é€šç·šè·¯ (Transport) é‚„æ˜¯é£›æ©Ÿç·šè·¯ (Flight)
            const isFlight = step.isFlight || false;

            // è·¯ç·šä¸­é–“çš„å‹•æ…‹ç¬¦è™Ÿ
            // æ ¹æ“šä½¿ç”¨è€…è¦æ±‚ï¼Œç§»é™¤å‹•æ…‹ç¬¦è™Ÿ (â–º / Â»)ï¼Œåªä¿ç•™ç©ºå­—ä¸²
            let dynamicLineContent = '';

            return `
                <div class="transport-card p-4 rounded-lg shadow-md mb-6 hover:ring-2 hover:ring-red-300">
                    <div class="flex items-center justify-between mb-2">
                        <h4 class="text-lg font-bold text-red-700">${method}</h4>
                        <span class="text-sm font-semibold bg-red-100 text-red-800 px-3 py-1 rounded-full">${cost}</span>
                    </div>
                    <div class="flex items-center mt-3">
                        <div class="flex flex-col items-center min-w-[80px] text-center">
                            <div class="w-3 h-3 ${isFlight ? 'bg-purple-700' : 'bg-red-700'} rounded-full"></div>
                            <span class="text-sm mt-1 font-medium">${cleanLocationName(step.from)}</span>
                        </div>
                        <div class="${isFlight ? 'flight-line' : 'transport-line'} mx-2 flex items-center justify-center flex-grow">
                            ${dynamicLineContent}
                            <div class="transport-label">${labelText}</div>
                        </div>
                        <div class="flex flex-col items-center min-w-[80px] text-center">
                            <div class="w-3 h-3 ${isFlight ? 'bg-purple-700' : 'bg-red-700'} rounded-full"></div>
                            <span class="text-sm mt-1 font-bold ${isFlight ? 'text-purple-700' : 'text-red-700'}">${cleanLocationName(step.to)}</span>
                        </div>
                    </div>
                    <div class="mt-4 border-t pt-3 border-gray-200">
                        <p class="text-sm text-gray-700"><span class="font-bold ${isFlight ? 'text-purple-600' : 'text-red-600'}">æ–¹å‘:</span> ${cleanLocationName(step.direction)}</p>
                        ${transferInfo}
                    </div>
                </div>
            `;
        }

        /**
         * æ¸²æŸ“æ¯æ—¥è¡Œç¨‹çš„ç·Šæ¹Šå‹æ¨™é¡Œï¼Œä¸¦å°‡å…¶æ’å…¥åˆ° main-header å€åŸŸã€‚
         * @param {object} dayData - ç•¶æ—¥è¡Œç¨‹æ•¸æ“š
         */
        function renderDayHeader(dayData) {
            const header = document.getElementById('main-header');
            const mainTitle = document.getElementById('main-title');
            const subTitle = document.getElementById('sub-title');

            // 1. éš±è—/ç§»é™¤å°é¢æ¨™é¡Œå…ƒç´ ï¼Œè®“å‡ºç©ºé–“
            mainTitle.classList.add('hidden-content');
            subTitle.classList.add('hidden-content');
            header.style.animation = 'none';
            
            // 2. æº–å‚™æ–°çš„ç·Šæ¹Šå‹æ¨™é¡Œå…§å®¹
            const chineseDayMatch = dayData.date.match(/\((.)\)/);
            const chineseDay = chineseDayMatch ? chineseDayMatch[1] : '';
            const jpDay = dayMap[chineseDay] || { name: '', color: 'text-gray-500' };

            const dateHtml = `
                <span class="text-xl font-bold">${dayData.date}</span>
                <span class="text-base font-normal ml-2 ${jpDay.color}">( ${jpDay.name} )</span>
            `;

            const newHeaderHtml = `
                <div id="day-header-compact" class="day-header-compact flex flex-col items-center p-4 border-b-2 border-red-300 w-full bg-white/50 backdrop-blur-sm rounded-xl shadow-lg">
                    <div class="flex items-center text-red-800 mb-2">
                        <span class="text-4xl font-extrabold mr-4">${dayData.day}</span>
                        <span class="text-2xl">${dateHtml}</span>
                    </div>
                    <h3 class="text-lg font-semibold text-gray-700 italic flex items-center">
                        <span class="mr-2 text-xl">ğŸ¯</span>${dayData.theme}
                    </h3>
                </div>
            `;
            
            // 3. æª¢æŸ¥æ˜¯å¦å·²å­˜åœ¨ï¼Œå¦‚æœå­˜åœ¨å‰‡æ›¿æ›ï¼Œå¦å‰‡æ’å…¥
            let existingCompact = document.getElementById('day-header-compact');
            if (existingCompact) {
                // æ›¿æ›å…§å®¹ä¸¦é‡ç½®å‹•ç•«
                existingCompact.outerHTML = newHeaderHtml;
            } else {
                // æ’å…¥æ–°å…ƒç´ åˆ° header çš„é ‚éƒ¨
                header.insertAdjacentHTML('afterbegin', newHeaderHtml);
            }

            // 4. ç¢ºä¿æ•´å€‹ header å®¹å™¨é¡¯ç¤º
            header.style.opacity = '1';
            header.style.transform = 'translateY(0)';
            header.style.pointerEvents = 'auto';
        }

        function renderItinerary(dayData) {
            const contentDiv = document.getElementById('itinerary-content');
            
            // æ³¨æ„ï¼šé€™è£¡ç§»é™¤äº†åŸæœ¬çš„ H2/H3 æ¨™é¡Œï¼Œå®ƒå€‘ç¾åœ¨ç”± renderDayHeader è™•ç†
            let html = `
                <div class="timeline-container relative">
                    <div id="timeline-line-${dayData.day}" class="timeline-line"></div>
            `;

            dayData.events.forEach((event, index) => {
                const isImportant = event.isImportant ? ' flashing-border ring-2 ring-red-200' : '';
                const contentId = `${dayData.day}-${index}-content`;
                const iconSvg = getEventIcon(event.type, event.method);

                let cardContentHtml = '';
                let bgColorClass = 'bg-white/75';
                
                // æ ¹æ“šé¡å‹è¨­å®šå¡ç‰‡é¡è‰²
                if (event.type === 'Transport') bgColorClass = 'bg-blue-100/50';
                else if (['Lunch', 'Dinner'].includes(event.type)) bgColorClass = 'bg-orange-100/50';
                else if (event.type === 'Activity') bgColorClass = 'bg-red-100/50';
                else if (event.type === 'Flight') bgColorClass = 'bg-purple-100/50'; // é£›æ©Ÿç”¨ç´«è‰²
                else if (event.type === 'Action' && event.action.includes('å…¥ä½é£¯åº—')) bgColorClass = 'bg-green-100/50'; 

                if (event.type === 'Transport' && event.steps && event.steps.length > 0) {
                    const headerHtml = `
                        <div class="flex-grow">
                            <h4 class="text-xl font-bold text-gray-800 flex items-center">
                                ${event.number} <span class="ml-2 text-sm font-normal text-gray-600 bg-white px-2 py-0.5 rounded border border-gray-200">${event.method}</span>
                            </h4>
                            <p class="text-sm text-gray-600 mt-1 font-medium flex items-center">
                                <span class="mr-1">â±ï¸</span> ${event.duration}
                            </p>
                        </div>
                        <svg class="w-6 h-6 text-gray-400 toggle-icon" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"></path></svg>
                    `;
                    const contentHtml = `<div class="pt-4 space-y-4">${event.steps.map((step, i) => renderTransportStep(step, index, event.steps.length, event.method, event.cost)).join('')}</div>`;
                    cardContentHtml = `
                        <div class="accordion-header cursor-pointer flex items-center" onclick="toggleDetails('${contentId}')">${headerHtml}</div>
                        <div id="${contentId}" class="collapsible-content" style="max-height: 0px;">${contentHtml}</div>
                    `;
                } else if (event.type === 'Flight') {
                    // é‡å° Flight äº‹ä»¶ï¼Œå°‡ isFlight æ¨™è¨˜å‚³å…¥ renderTransportStep å‡½å¼
                    const flightStep = { 
                        ...event.steps?.[0] || { 
                            from: cleanLocationName(event.location.split('â†’')[0]), 
                            to: cleanLocationName(event.location.split('â†’')[1]), 
                            serviceName: event.action, 
                            direction: event.details[0] 
                        }, 
                        isFlight: true,
                        // ä¿®æ­£ï¼šæ‰‹å‹•æ·»åŠ  Flight æ­¥é©Ÿçš„æœå‹™åç¨±
                        serviceName: event.action.split('æ­ä¹˜')[1]?.trim() || 'åœ‹éš›èˆªç­'
                    };
                    const flightCardHtml = renderTransportStep(flightStep, index, 1, 'èˆªç­', 'ç„¡è²»ç”¨'); 
                    
                    const headerHtml = `
                        <div class="flex-grow">
                            <h4 class="text-xl font-bold text-purple-700 flex items-center">
                                ${event.action}
                            </h4>
                            <p class="text-sm text-gray-600 mt-1 font-medium flex items-center">
                                <span class="mr-1">ğŸ—ºï¸</span> ${cleanLocationName(event.location)}
                            </p>
                        </div>
                        <svg class="w-6 h-6 text-gray-400 toggle-icon" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"></path></svg>
                    `;
                    const detailsList = event.details ? event.details.map(d => `<li class="flex items-start text-gray-700 mb-1"><span class="text-red-400 mr-2">â€¢</span>${d}</li>`).join('') : '';

                    cardContentHtml = `
                        <div class="accordion-header cursor-pointer flex items-center" onclick="toggleDetails('${contentId}')">${headerHtml}</div>
                        <div id="${contentId}" class="collapsible-content" style="max-height: 0px;">
                            <div class="pt-4 space-y-4">
                                ${flightCardHtml}
                                ${detailsList ? `<ul class="mt-3 pl-2 border-t border-gray-200 pt-2">${detailsList}</ul>` : ''}
                            </div>
                        </div>
                    `;

                } else {
                    const detailsList = event.details ? event.details.map(d => `<li class="flex items-start text-gray-700 mb-1"><span class="text-red-400 mr-2">â€¢</span>${d}</li>`).join('') : '';
                    const locationClean = cleanLocationName(event.location);
                    const headerHtml = `
                        <div class="flex-grow">
                            <h4 class="text-xl font-bold text-gray-900">${event.action}</h4>
                            ${locationClean ? `<p class="text-sm text-gray-600 mt-1 font-medium flex items-center"><span class="mr-1">ğŸ“</span>${locationClean}</p>` : ''}
                        </div>
                        ${detailsList ? `<svg class="w-6 h-6 text-gray-400 toggle-icon" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"></path></svg>` : ''}
                    `;
                    
                    cardContentHtml = `
                        <div class="accordion-header ${detailsList ? 'cursor-pointer' : ''} flex items-center" ${detailsList ? `onclick="toggleDetails('${contentId}')"` : ''}>${headerHtml}</div>
                        ${detailsList ? `<div id="${contentId}" class="collapsible-content" style="max-height: 0px;"><ul class="mt-3 pl-2 border-t border-gray-200 pt-2">${detailsList}</ul></div>` : ''}
                    `;

                    // ã€æ–°å¢é‚è¼¯ã€‘æª¢æŸ¥æ˜¯å¦ç‚º Day 7 çš„ ç¥æˆ¶å¸‚å€æ•£ç­–ï¼Œä¸¦æ’å…¥æŒ‰éˆ•
                    if (dayData.day === 'Day 7' && event.action === 'ç¥æˆ¶å¸‚å€æ•£ç­–') {
                        const kobeButtonHtml = `
                            <button onclick="showKobeModal()" class="mt-4 w-full bg-yellow-500 hover:bg-yellow-600 text-gray-800 font-bold py-2 px-4 rounded-lg shadow-md transition-all duration-300 flex items-center justify-center">
                                <span class="mr-2">ğŸ›ï¸</span> å‰å¾€ç¥æˆ¶é€›è¡—åœ°åœ–
                            </button>
                        `;
                        cardContentHtml += kobeButtonHtml;
                    }
                }

                html += `
                    <div class="timeline-item group" id="timeline-item-${index}">
                        <div class="timeline-icon group-hover:scale-110 transition-transform bg-white">
                            ${iconSvg}
                        </div>
                        <!-- å¡ç‰‡æ‡‰ç”¨åŠé€æ˜åº•è‰²å’Œç»ç’ƒæ¨¡ç³Šæ•ˆæœ -->
                        <div class="timeline-content-card ${bgColorClass} p-5 rounded-xl shadow-md border border-gray-100 hover:shadow-lg ${isImportant}">
                             <div class="timeline-time-box shadow-sm border border-yellow-200">
                                 ${event.time}
                            </div>
                            ${cardContentHtml}
                        </div>
                    </div>
                `;
            });

            html += `</div>`;
            contentDiv.innerHTML = html;
            contentDiv.classList.add('show');
            
            // ã€ä¿®æ­£ 3 - è¼‰å…¥ã€‘åœ¨å…§å®¹æ¸²æŸ“å®Œæˆå¾Œï¼Œé¦–æ¬¡è¨ˆç®—ä¸¦è¨­ç½®æ™‚é–“è»¸ç·šçš„é«˜åº¦
            // å»¶é²åŸ·è¡Œï¼Œç¢ºä¿æ‰€æœ‰ DOM å…ƒç´ éƒ½å·²æ­£ç¢ºæ¸¬é‡é«˜åº¦
            setTimeout(() => updateTimelineHeight(dayData.day), 50);
        }

        // ã€é‡æ§‹ã€‘é€šç”¨å­—ç¬¦å‹•ç•«å‡½å¼ (ä¿æŒä¸è®Š)
        function applyCharacterAnimation(elementId, rawText, animationName, delayIncrement, duration = '4s', iteration = 'infinite') {
            const element = document.getElementById(elementId);
            if (!element) return;

            let delay = 0;
            let animatedHtml = '';
            
            // è™•ç†æ›è¡Œç¬¦è™Ÿ <br> ç‚º \nï¼Œç„¶å¾Œåˆ†å‰²å­—ç¬¦ (Array.from è™•ç†å¤šå­—ç¯€å­—ç¬¦)
            const textWithBreaks = rawText.replace(/<br>/g, '\n'); 
            const characters = Array.from(textWithBreaks); 

            element.innerHTML = ''; 

            characters.forEach((char) => {
                if (char === '\n') {
                    animatedHtml += '<br>';
                    // é‡è¨­ delayï¼Œè®“ä¸‹ä¸€è¡Œå¾é ­é–‹å§‹å‹•ç•«
                    delay = 0; 
                } else if (char === ' ') {
                    animatedHtml += '&nbsp;'; // ä½¿ç”¨ä¸æ›è¡Œç©ºæ ¼ç¢ºä¿é–“è·
                } else {
                    // ç§»é™¤å…§è¯çš„ opacity:0ï¼Œå®Œå…¨ä¾é  keyframes å’Œ animation-fill-mode: both ä¾†æ§åˆ¶èµ·å§‹ç‹€æ…‹
                    animatedHtml += `<span style="display:inline-block; animation: ${animationName} ${duration} ease-in-out ${iteration} both; animation-delay: ${delay}s;">${char}</span>`;
                    delay += delayIncrement;
                }
            });

            element.innerHTML = animatedHtml;
        }

        function renderSidebar() {
            const sidebarNav = document.getElementById('sidebar');
            
            // ã€ä¿®æ­£ 1ã€‘æ–°å¢å›åˆ°é¦–é æŒ‰éˆ• (Day 0)
            let itemsHtml = `
                <div class="sidebar-item active" onclick="switchDay(0)" id="sidebar-item-home">
                    <div class="sidebar-icon-container text-red-600">
                        <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 12l2-2m0 0l7-7 7 7M5 10v10a1 1 0 001 1h3m10-11l2 2m-2-2v10a1 1 0 01-1 1h-3m-6 0a1 1 0 001-1v-4a1 1 0 011-1h2a1 1 0 011 1v4a1 1 0 001 1m-6 0h6"></path></svg>
                    </div>
                    <div class="sidebar-text">
                        <div class="sidebar-text-day" style="font-size:1.1rem; font-weight:800; color: #b91c1c;">å›åˆ°é¦–é </div>
                        <div class="sidebar-text-date text-gray-500">ç¸½è¦½ / å°é¢</div>
                    </div>
                </div>
            `;

            const dayItemsHtml = itineraryData.map((data, index) => {
                const dayNum = index + 1;
                return `
                    <div class="sidebar-item" onclick="switchDay(${dayNum})" id="sidebar-item-${dayNum}">
                        <div class="sidebar-icon-container text-gray-600">
                            <span class="font-bold text-lg">${dayNum}</span>
                        </div>
                        <div class="sidebar-text">
                            <div class="sidebar-text-day">DAY ${dayNum}</div>
                            <div class="sidebar-text-date">${data.date}</div>
                        </div>
                    </div>
                `;
            }).join('');
            
            sidebarNav.innerHTML = itemsHtml + dayItemsHtml;
        }

        function switchDay(dayNum) {
            const contentDiv = document.getElementById('itinerary-content');
            const header = document.getElementById('main-header');
            
            // 1. é‡è¨­æ‰€æœ‰å´é‚Šæ¬„é …ç›®ç‚ºéæ´»èºç‹€æ…‹
            document.querySelectorAll('.sidebar-item').forEach(item => item.classList.remove('active'));

            // 2. è™•ç† Day 0 (å›åˆ°é¦–é ) é‚è¼¯
            if (dayNum === 0) {
                // é¡¯ç¤ºå°é¢æ¨™é¡Œå…ƒç´ 
                document.getElementById('main-title').classList.remove('hidden-content');
                document.getElementById('sub-title').classList.remove('hidden-content');
                
                // ç§»é™¤ç·Šæ¹Šå‹æ—¥æ›†æ¨™é¡Œ
                const existingCompact = document.getElementById('day-header-compact');
                if (existingCompact) existingCompact.remove();

                if(header) {
                    // è®“ Header åŸ·è¡Œ In å‹•ç•«
                    header.style.animation = 'headerFadeIn 0.5s ease-out forwards';
                    header.style.pointerEvents = 'auto'; // ç¢ºä¿å¯ä»¥é»æ“Š
                }
                contentDiv.classList.remove('show');
                contentDiv.style.display = 'none';
                contentDiv.innerHTML = '';
                const homeItem = document.getElementById('sidebar-item-home');
                if (homeItem) homeItem.classList.add('active');
            } else {
                // è™•ç†ä¸€èˆ¬æ—¥æœŸè¡Œç¨‹ (Day 1, 2, ...) é‚è¼¯
                const dayData = itineraryData.find((d, i) => i + 1 === dayNum);
                
                if (dayData) {
                    // ç«‹å³æ¸²æŸ“ç·Šæ¹Šå‹æ¨™é¡Œï¼Œä½”æ“šç©ºé–“ä¸¦æä¾›ä¸»é¡Œè³‡è¨Š
                    renderDayHeader(dayData);

                    // ç¢ºä¿å…§å®¹å€åœ¨åˆ‡æ›å‰éš±è—ï¼Œä»¥ä¾¿å‹•ç•«é‡æ–°é–‹å§‹
                    contentDiv.classList.remove('show');
                    contentDiv.style.display = 'none';
                    
                    const activeItem = document.getElementById(`sidebar-item-${dayNum}`);
                    if (activeItem) activeItem.classList.add('active');
                    
                    // å»¶é²æ¸²æŸ“è¡Œç¨‹ç´°ç¯€ï¼Œè®“æ¨™é¡Œå‹•ç•«æœ‰æ™‚é–“å®Œæˆ
                    setTimeout(() => {
                        contentDiv.style.display = 'block';
                        renderItinerary(dayData);
                        
                        // æ»¾å‹•åˆ°å…§å®¹å€é ‚éƒ¨ï¼Œä½†ä¸è¦å®Œå…¨é ‚è‘—
                        window.scrollTo({ top: contentDiv.offsetTop - 100, behavior: 'smooth' });
                    }, 50); 
                }
            }
            
            currentDay = dayNum;
            // ç¢ºä¿æ¯æ¬¡åˆ‡æ›å¾Œéƒ½èƒ½é‡æ–°è§¸ç™¼æ»¾å‹•é‚è¼¯
            handleScroll();
        }

        // =================================================================
        // 4. æ¥“è‘‰ç‰¹æ•ˆ (ä¿æŒä¸è®Š)
        // =================================================================
        function createMapleLeaf() {
            const container = document.getElementById('maple-fall-container');
            if(!container) return;
            const leaf = document.createElement('div');
            leaf.className = 'maple-leaf';
            leaf.style.left = Math.random() * 100 + 'vw';
            const size = 10 + Math.random() * 15;
            leaf.style.width = size + 'px';
            leaf.style.height = size + 'px';
            leaf.style.backgroundColor = ['#e53e3e', '#dd6b20', '#f6ad55', '#fed7d7'][Math.floor(Math.random() * 4)];
            
            const duration = 10 + Math.random() * 10;
            leaf.style.animationDuration = duration + 's';
            leaf.style.animationName = 'fall' + Math.floor(Math.random() * 2);
            
            container.appendChild(leaf);
            setTimeout(() => leaf.remove(), duration * 1000);
        }

        function startMapleFall() {
            // è®“åˆå§‹é£„è½çš„æ¥“è‘‰æ›´å¤š
            for (let i = 0; i < 50; i++) setTimeout(createMapleLeaf, Math.random() * 5000); 
            // å¢åŠ æŒçºŒç”Ÿæˆé€Ÿåº¦
            setInterval(() => {
                const count = Math.floor(Math.random() * 5) + 3; // 3 to 7 leaves
                for(let i=0; i<count; i++) createMapleLeaf();
            }, 500);
        }

        // ã€å‡ç´š 2ã€‘è™•ç†æ»¾å‹•äº‹ä»¶ï¼Œè®“é ‚éƒ¨å°èˆªæ¬„ç¸®æ”¾ï¼Œä¸¦æ§åˆ¶ä¸»æ¨™é¡Œæ·¡å…¥æ·¡å‡º
        function handleScroll() {
            const sidebar = document.getElementById('sidebar');
            const header = document.getElementById('main-header');
            const scrollTop = window.scrollY;
            const scrollThreshold = 100; // æ»¾å‹•è¶…é 100px é–‹å§‹è®ŠåŒ–

            // 1. å°èˆªæ¬„ç·Šæ¹Šæ¨¡å¼
            if (scrollTop > 50) { // ç¨å¾®é™ä½è§¸ç™¼é»ï¼Œè®“å°èˆªæ¬„æ›´å¿«ç¸®å°
                sidebar.classList.add('compact');
            } else {
                sidebar.classList.remove('compact');
            }

            // 2. ä¸»æ¨™é¡Œæ·¡å‡º/æ·¡å…¥æ§åˆ¶
            // æ³¨æ„ï¼šåªæœ‰åœ¨é¦–é  (currentDay === 0) æ‰æœƒæœ‰æ·¡å‡ºæ•ˆæœ
            if (header && currentDay === 0) { 
                if (scrollTop > scrollThreshold) {
                    // å‘ä¸‹æ»¾å‹•è¶…éé–€æª»ï¼Œæ·¡å‡ºä¸»æ¨™é¡Œ
                    header.style.opacity = '0';
                    header.style.transform = 'translateY(-30px)';
                    header.style.pointerEvents = 'none';
                } else {
                    // å‘ä¸Šæ»¾å‹•æˆ–åœ¨é ‚éƒ¨ï¼Œæ·¡å…¥ä¸»æ¨™é¡Œ
                    const opacity = 1 - (scrollTop / scrollThreshold);
                    header.style.opacity = Math.max(0, opacity);
                    header.style.transform = `translateY(${(-scrollTop / 3)}px)`; // è¼•å¾®è¦–å·®æ•ˆæœ
                    header.style.pointerEvents = 'auto';
                }
            }

            lastScrollTop = scrollTop;
        }

        // =================================================================
        // 6. å®¢è£½åŒ– Modal å‡½å¼
        // =================================================================
        function showKobeModal() {
            const modal = document.getElementById('kobe-modal');
            modal.classList.add('show');
        }

        function hideKobeModal() {
            const modal = document.getElementById('kobe-modal');
            modal.classList.remove('show');
        }

        function navigateToKobe() {
            hideKobeModal();
            // ä½¿ç”¨ window.open åœ¨æ–°åˆ†é é–‹å•Ÿé€£çµ
            window.open('https://xyuan0788.github.io/JP25/kobe.html', '_blank');
        }


        // =================================================================
        // 5. åˆå§‹åŒ– (Initialize)
        // =================================================================
        function initializeApp() {
            renderSidebar();
            startMapleFall();
            
            // ã€æ–°å¢ã€‘æ»¾å‹•ç›£è½å™¨
            window.addEventListener('scroll', handleScroll);

            // --- æ¨™é¡Œå‹•ç•«è¨­å®šå€å¡Š ---
            const mainTitleText = "2025 å¤§é˜ªæ¥“å¹´ç¥­<br>æ•£ç­–æ—…åœ–";
            const subTitleText = "æˆ‘å¥½æƒ³å¥½æƒ³é£› ğŸ é€ƒé€²é‚£å€‹æ¥“ç‹‚ä¸–ç•Œ";
            
            // æ‡‰ç”¨å­—ç¬¦æ¼‚æµ®å‹•ç•« (ä¸»æ¨™é¡Œ, é‡è¤‡æ¼‚æµ®)
            applyCharacterAnimation('main-title', mainTitleText, 'charFloat', 0.15, '4s', 'infinite');
            
            // æ‡‰ç”¨å­—ç¬¦æ»‘å‹•å‹•ç•« (å‰¯æ¨™é¡Œ, åªåŸ·è¡Œä¸€æ¬¡ slide-in)
            applyCharacterAnimation('sub-title', subTitleText, 'charSlideUp', 0.05, '0.8s', 'forwards');
            
            // è¼‰å…¥æ™‚é è¨­é¡¯ç¤ºé¦–é  (Day 0)
            if (itineraryData.length > 0) {
                setTimeout(() => switchDay(0), 50); 
            }

            // ç¢ºä¿æ¥“è‘‰çš„ CSS è¨­ç½®
            const mapleStyleSheet = document.createElement("style");
            mapleStyleSheet.innerText = `
                :root { --wind-x: 5vw; } 
                @keyframes fall0 {
                    0% { transform: translateY(-10vh) rotateZ(0deg); opacity: 0; }
                    10% { opacity: 1; }
                    100% { transform: translateY(105vh) translateX(var(--wind-x)) rotateZ(720deg); opacity: 0; }
                }
                @keyframes fall1 {
                    0% { transform: translateY(-10vh) rotateZ(180deg); opacity: 0; }
                    10% { opacity: 1; }
                    100% { transform: translateY(105vh) translateX(calc(var(--wind-x) * -0.5)) rotateZ(900deg); opacity: 0; } 
                }
            `;
            document.head.appendChild(mapleStyleSheet);
        }

        // Run when DOM is ready
        document.addEventListener('DOMContentLoaded', initializeApp);

    </script>
</body>

</html>
